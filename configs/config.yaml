# ============================================================================
# VLM Layer-wise Analysis Configuration
# ============================================================================

# ----------------------------------------------------------------------------
# Model Configuration
# qwen: [Qwen/Qwen2.5-VL-3B-Instruct, Qwen/Qwen2.5-VL-7B-Instruct]
# llava: [llava-hf/llava-1.5-7b-hf, llava-hf/llava-1.5-13b-hf]
# intern_vl: [OpenGVLab/InternVL3_5-4B]
# gemma: [google/gemma-3-4b-it]
# ----------------------------------------------------------------------------
model:
  name: qwen
  model_id: Qwen/Qwen2.5-VL-7B-Instruct
  use_int8: false
  use_fast_processor: true
  llm_layers: all  # or specify list like [0, 6, 12, 19, 25, 30, 35]
  device: cuda

# ----------------------------------------------------------------------------
# Dataset Configuration
# ----------------------------------------------------------------------------
dataset:
  # HuggingFace dataset settings (recommended)
  # Dataset: https://huggingface.co/datasets/Hanoi0126/visual-object-attributes
  hf_dataset: "Hanoi0126/visual-object-attributes"
  hf_split: "auto"  # "auto" uses task name as split (e.g., "color", "count"), or use "train" for all tasks
  hf_subset: null
  
  # Column names in the HF dataset
  image_column: "image"
  label_column: "label"
  task_column: "task"
  
  # Local dataset (alternative - set hf_dataset to null to use this)
  dataset_dir: null  # e.g., /path/to/dataset
  csv_filename: "ALL_metadata.csv"

# ----------------------------------------------------------------------------
# Experiment Configuration
# ----------------------------------------------------------------------------
experiment:
  # Tasks to run (both single-obj and multi-obj)
  # All tasks now use the 'question' field from the dataset
  tasks:
    - count
    - position
    - occlusion
    - shape
    - color
    - size
    - location
    - angle
  
# ----------------------------------------------------------------------------
# Probing Configuration
# ----------------------------------------------------------------------------
probe:
  enabled: false  # Set to false to skip probing (useful for quick VLM/LLM comparison)
  n_folds: 5
  seed: 0
  max_iter: 2000
  C: 1.0
  solver: liblinear

# ----------------------------------------------------------------------------
# Output Configuration
# ----------------------------------------------------------------------------
output:
  results_root: /work/gb20/b20070/vlm-analysis/results
  save_features: true
  save_plots: true

# ----------------------------------------------------------------------------
# Logit Analysis Configuration
# ----------------------------------------------------------------------------
logit_analysis:
  extract_logits: true  # Set to true to extract logits from all layers
  save_full_logits: false  # Save full vocab logits (can be very large)
  save_choice_logits: true  # Save choice logits only (recommended)

# ----------------------------------------------------------------------------
# Ablation Experiment Configuration
# ----------------------------------------------------------------------------
ablation:
  enabled: true
  method: "zero"  # zero | mean | random
  phases:
    layer_screening: false
    head_analysis: false
    combination: false
    multi_head: true  # Progressive multi-head ablation experiment
  target_layers: "all"  # "all" for all layers, or specify list like [14,15,16,17], or null to auto-detect from phase1
  evaluation_position: "answer_head"  # answer_head | last | mean
  statistical:
    bootstrap_samples: 1000
    confidence_level: 0.95
    significance_threshold: 0.001
    effect_size_threshold: 0.30  # delta_acc threshold for "important head"
  multi_head:
    enabled: false  # Set to true to enable multi-head ablation experiment
    n_heads_values: [1, 2, 4, 8, 16, 24, 28]  # Number of heads to ablate progressively
    n_trials: 10  # Number of random trials per n_heads
    random_seed: 42  # Random seed for reproducibility
    target_layers: [19, 20, 21, 22, 23, 24, 25, 26, 27]  # Layers to analyze, or "all" or null to use ablation.target_layers

# ----------------------------------------------------------------------------
# Experiment Settings
# ----------------------------------------------------------------------------
batch_size: 8
device: cuda
seed: 0

# Feature extraction
decode: true
max_new_tokens: 32
do_sample: false

# ----------------------------------------------------------------------------
# Hydra Configuration
# ----------------------------------------------------------------------------
hydra:
  output_subdir: null
  run:
    dir: .